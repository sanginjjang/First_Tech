<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Document</title>
<link rel="stylesheet" href="/styles1.css">

</head>

<body>
	<header>
		<div id="logo">
			<a href="/"> <img src="/uploads/logo.webp" alt="" width="100px">
			</a>
		</div>
		<div class="search">
			<form action="/s/searchResult2" method="post" id="form">
				<select id="searchSelect" name="searchPart">
					<option value="searchApplication">공고명</option>
					<option value="searchCompany">기업명</option>
				</select> <input type="text" name="mainSearchInput" placeholder="텍스트를 입력하세요">
				<th:block th:if="${session.user != null}">
					<button id="searchBtn">검색</button>
				</th:block>
				<th:block th:if="${session.user == null}">
					<button id="searchBtn" onclick="noSearch(event)">검색</button>
				</th:block>
			</form>
		</div>
		<div id="header-right">
			<th:block th:if="${session.user == null}">
				<span><a href="/hyepin/login">로그인</a></span>
				<span><a href="/hyepin/join">회원가입</a></span>
				<span><a href="/hyepin/companyMain">기업 홈</a></span>
			</th:block>
			<th:block th:if="${session.user != null}">
				<span><a href="/hyepin/goUserInformation">마이페이지</a></span>
				<span><a href="/hyepin/logout">로그아웃</a></span>
			</th:block>
		</div>
	</header>
	<nav>
		<div class="nav-left">
			<th:block th:if="${session.user == null}">
				<div onclick="noLogin()">채용공고</div>
				<div onclick="noLogin()">기업정보</div>
				<div onclick="noLogin()">지원현황</div>
				<div onclick="noLogin()">이력서관리</div>
				<div onclick="noLogin()">커뮤니티</div>
			</th:block>

			<th:block th:if="${session.user != null}">
				<div>
					<a href="/sangin/applicationsForm">채용공고</a>
				</div>
				<div>
					<a href="/c/companyInfo/1">기업정보</a>
				</div>
				<div>
					<a href="/resume/resumeApplyList">지원현황</a>
				</div>
				<div>
					<a href="/resume/MyResumeList">이력서관리</a>
				</div>
				<div>
					<a href="/b/board/1">커뮤니티</a>
				</div>
			</th:block>
		</div>

		<div class="nav-right">
			<div>FAQ</div>
		</div>
	</nav>

	<section>
		<div class="section_search">
			<div class="search_left">
				<div class="search_btn">
					<button id="jobBtn">직무별</button>
					<button id="regionBtn">지역별</button>
				</div>
				<div id="jobChecklist" class="checklist-container">
					<ul class="checklist">
						<li><input type="checkbox" id="job_1" value="1"><label
							for="job_1" class="roleId">개발자</label></li>
						<li><input type="checkbox" id="job_2" value="2"><label
							for="job_2" class="roleId">기술지원</label></li>
						<li><input type="checkbox" id="job_3" value="3"><label
							for="job_3" class="roleId">데이터분석가</label></li>
						<li><input type="checkbox" id="job_4" value="4"><label
							for="job_4" class="roleId">데이터엔지니어</label></li>
						<li><input type="checkbox" id="job_5" value="5"><label
							for="job_5" class="roleId">백엔드/서버개발</label></li>
						<li><input type="checkbox" id="job_6" value="6"><label
							for="job_6" class="roleId">보안컨설팅</label></li>
						<li><input type="checkbox" id="job_7" value="7"><label
							for="job_7" class="roleId">앱개발</label></li>
						<li><input type="checkbox" id="job_8" value="8"><label
							for="job_8" class="roleId">웹개발</label></li>
						<li><input type="checkbox" id="job_9" value="9"><label
							for="job_9" class="roleId">웹마스터</label></li>
						<li><input type="checkbox" id="job_10" value="10"><label
							for="job_10" class="roleId">유지보수</label></li>
						<li><input type="checkbox" id="job_11" value="11"><label
							for="job_11" class="roleId">정보보안</label></li>
						<li><input type="checkbox" id="job_12" value="12"><label
							for="job_12" class="roleId">프론트엔드</label></li>
						<li><input type="checkbox" id="job_13" value="13"><label
							for="job_13" class="roleId">퍼블리셔</label></li>
						<li><input type="checkbox" id="job_14" value="14"><label
							for="job_14" class="roleId">BI엔지니어</label></li>
						<li><input type="checkbox" id="job_15" value="15"><label
							for="job_15" class="roleId">CISO</label></li>
					</ul>
				</div>
				<div id="regionChecklist" class="checklist-container">
					<ul class="checklist">
						<li><input type="checkbox" id="region_all" value="all"><label
							class="workingArea" for="region_all">ALL</label></li>
						<li><input type="checkbox" id="region_seoul" value="서울"><label
							class="workingArea" for="region_seoul">서울</label></li>
						<li><input type="checkbox" id="region_gyeonggi" value="경기"><label
							class="workingArea" for="region_gyeonggi">경기</label></li>
						<li><input type="checkbox" id="region_gwangju" value="광주"><label
							class="workingArea" for="region_gwangju">광주</label></li>
						<li><input type="checkbox" id="region_daegu" value="대구"><label
							class="workingArea" for="region_daegu">대구</label></li>
						<li><input type="checkbox" id="region_daejeon" value="대전"><label
							class="workingArea" for="region_daejeon">대전</label></li>
						<li><input type="checkbox" id="region_busan" value="부산"><label
							class="workingArea" for="region_busan">부산</label></li>
						<li><input type="checkbox" id="region_ulsan" value="울산"><label
							class="workingArea" for="region_ulsan">울산</label></li>
						<li><input type="checkbox" id="region_incheon" value="인천"><label
							class="workingArea" for="region_incheon">인천</label></li>
						<li><input type="checkbox" id="region_gangwon" value="강원"><label
							class="workingArea" for="region_gangwon">강원</label></li>
						<li><input type="checkbox" id="region_gyeongnam" value="경남"><label
							class="workingArea" for="region_gyeongnam">경남</label></li>
						<li><input type="checkbox" id="region_jeju" value="제주"><label
							class="workingArea" for="region_jeju">제주</label></li>
					</ul>
				</div>
			</div>
			<div class="search_right">
				<input type="text" id="searching">
				<button id="searchBtn">검색</button>
			</div>
		</div>
		<aside class="section_aside">aside 공사 중...</aside>
	</section>
	<main>
		<div id="applicationList">
			<!-- 기본 HTML 내용은 서버에서 Thymeleaf로 렌더링 -->
			<th:block th:each="jobApplication : ${applicationList}">
				<div class="application">
					<div class="heart">
						<button
							th:classappend="${jobApplication.isBookmarked != 0} ? 'colorHeart' : 'uncolorHeart'"
							th:text="${jobApplication.isBookmarked != 0} ? '♥' : '♡'"
							th:attr="data-application-num=${jobApplication.applicationNum}">
						</button>

					</div>
					<div class="application_center">
						<div class="jobApplicationName">
							<a
								th:href="@{/sangin/applicationDetailForm/{applicationNum}(applicationNum=${jobApplication.applicationNum})}"
								id="applicationName">[[${jobApplication.applicationName}]]</a>
						</div>
						<div class="required">
							<div th:text="${jobApplication.workingArea}">지역</div>
							<div th:text="${jobApplication.career}">경력</div>
							<div th:text="${jobApplication.education}">학력</div>
							<div th:text="${jobApplication.employmentType}">근무형태</div>
							<div th:text="${jobApplication.salary}">급여</div>
						</div>
					</div>
					<div class="application_rigth">
						<div class="companyId" th:text="${jobApplication.companyId}">기업명</div>
						<div class="star">
							<button
								th:class="${companyList.contains(jobApplication.companyId)} ? 'colorStar' : 'uncolorStar'"
								th:text="${companyList.contains(jobApplication.companyId)} ? '★' : '☆'"
								th:attr="data-company-id=${jobApplication.companyId}"></button>

						</div>
					</div>
				</div>
			</th:block>
		</div>


		<aside class="main_aside">aside 공사 중...</aside>

	</main>
	<footer> © 2024 회사 이름. 모든 권리 보유. </footer>
	<script>
        function noLogin() {
            alert("로그인 후 이용해 주세요.");
        }
        function noSearch() {
            event.preventDefault(); // 폼 제출 방지
            alert("로그인 후 이용해 주세요.");
        }

    </script>
	<!-- 체크 박스 나타나기 스크립트 -->
	<script>
        const jobBtn = document.getElementById('jobBtn');
        const regionBtn = document.getElementById('regionBtn');
        const jobChecklist = document.getElementById('jobChecklist');
        const regionChecklist = document.getElementById('regionChecklist');

        jobBtn.addEventListener('click', () => {
            jobChecklist.classList.add('active');
            regionChecklist.classList.remove('active');
        });

        regionBtn.addEventListener('click', () => {
            regionChecklist.classList.add('active');
            jobChecklist.classList.remove('active');
        });
    </script>
	<!-- 체크박스 스크립트 -->
	<script>
        const allCheckbox = document.getElementById("region_all");
        const regionAllLabel = document.querySelector('label[for="region_all"]');
        // 원하는 작업 수행
        regionAllLabel.style.color = "red"; // 예: 글자색 변경
        const checkboxes = document.querySelectorAll('input[type="checkbox"]:not(#region_all)'); // 나머지 체크박스
        const section = document.querySelector("section");
        section.addEventListener('click', (event) => {
            const target = event.target;
            //섹션에서 타겟 발견
            if (target === allCheckbox || target.tagName === "LABEL" && target.htmlFor === "region_all") {
                //타겟이 만약 전체 라벨이면
                //input 체크 상태 변수에 할당
                //내가 해야할건 ? label 누르면 전체 체크 상태 바꾸기
                allCheckbox.checked = !allCheckbox.checked;
                const isChecked = allCheckbox.checked;
                checkboxes.forEach((checkbox) => {
                    checkbox.checked = isChecked;
                });
                return;
            }
            if (target.classList.contains('workingArea')) {
                allCheckbox.checked = false;
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                })
                target.checked = true;
            }
            if (target.classList.contains('roleId')) {
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                })
                target.checked = true;
            }
        })

    </script>
	<!-- 클릭시 url 설정, 벨류값 전송 -->
	<script>
        document.querySelector("section").addEventListener("click", (event) => {
            let url = "";
            let value = "";
            let listKey = "";

            if (event.target.classList.contains("workingArea")) {
                url = "/sangin/searchingByArea";
                listKey = "listByArea";
                value = event.target.value;
                alert("지역 옳게 진행되고 있습니다~~");
            } else if (event.target.classList.contains("roleId")) {
                url = "/sangin/searchingByRoleId";
                listKey = "listByRoleId";
                value = event.target.value;
                alert("직무 옳게 진행되고 있습니다~~");
            } else if (event.target.id === "searchBtn") {
                url = "/sangin/searchingByKeyword";
                listKey = "listByKeyword";
                value = document.querySelector("#searching").value;
                alert("키워드 옳게 진행되고 있습니다~~");
            } else {
                return;
            }

            // AJAX 요청
            const xhr = new XMLHttpRequest();
            xhr.open("POST", url, true);
            xhr.setRequestHeader("Content-Type", "application/json");

            xhr.onload = function () {
                if (xhr.status === 200) {
                    console.log("AJAX 성공:", xhr.responseText); // 응답 확인
                    const response = JSON.parse(xhr.responseText);
                    console.log("응답 데이터:", response); // 데이터 확인
                    updateApplicationList(response.listByArea || response.listByRoleId || response.listByKeyword);
                } else {
                    console.error("AJAX 요청 실패:", xhr.status, xhr.statusText);
                }
            };

            xhr.send(JSON.stringify({ value })); 

        });

    </script>
	<!-- 채용 공고 리스트를 업데이트하는 함수 -->
	<script>
	function updateApplicationList(jobApplications) {
	    console.log("업데이트할 공고 리스트:", jobApplications); // 리스트 확인
	    const applicationList = document.querySelector("#applicationList");
	    applicationList.innerHTML = ""; // 기존 리스트 초기화

	    if (!jobApplications || jobApplications.length === 0) {
	        console.log("업데이트할 공고가 없습니다.");
	        applicationList.innerHTML = "<p>공고가 없습니다.</p>";
	        return;
	    }

	    jobApplications.forEach((jobApplication) => {
	        console.log("현재 공고 데이터:", jobApplication); // 공고 데이터 확인
	        const div = document.createElement("div");
	        div.className = "application";

	        div.innerHTML = `
	            <div class="heart">
	                <button class="${jobApplication.isBookmarked !== 0 ? 'colorHeart' : 'uncolorHeart'}"
	                        data-application-num="${jobApplication.applicationNum}">
	                    ${jobApplication.isBookmarked !== 0 ? "♥" : "♡"}
	                </button>
	            </div>
	            <div class="application_center">
	                <div class="jobApplicationName">
	                    <a href="/sangin/applicationDetailForm/${jobApplication.applicationNum}" id="applicationName">
	                        ${jobApplication.applicationName}
	                    </a>
	                </div>
	                <div class="required">
	                    <div>${jobApplication.workingArea}</div>
	                    <div>${jobApplication.career}</div>
	                    <div>${jobApplication.education}</div>
	                    <div>${jobApplication.employmentType}</div>
	                    <div>${jobApplication.salary}</div>
	                </div>
	            </div>
	            <div class="application_rigth">
	                <div>${jobApplication.companyId}</div>
	                <button class="${jobApplication.isCompanyBookmarked !== 0 ? 'colorStar' : 'uncolorStar'}"
	                        data-company-id="${jobApplication.companyId}">
	                    ${jobApplication.isCompanyBookmarked !== 0 ? "★" : "☆"}
	                </button>
	            </div>
	        `;
	        applicationList.appendChild(div);
	    });
	}

    </script>


</body>

</html>